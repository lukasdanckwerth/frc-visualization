<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, shrink-to-fit=no"
    />
    <link rel="stylesheet" href="./css/lotivis.css" />
    <link rel="stylesheet" href="./css/frcv.css" />
    <title>FRCV - Departments Data</title>
    <style>
      #map-chart-paris svg .ltv-map-label {
        transform: translate(-40px, 0);
      }
    </style>
  </head>
  <body>
    <div class="frcv-container">
      <div class="frcv-header">
        <a href="index.html"> Back </a>
      </div>
      <div>
        <div style="width: 400px; display: inline-block; vertical-align: top">
          <div class="frcv-info-card">
            <h2>Departments Data</h2>
            <select id="data" onchange="dataChange()">
              <option>Artists</option>
              <option>Tracks</option>
              <option>Tokens and Types</option>
            </select>
            <span> &NonBreakingSpace; </span>
            <label for="labels">Labels:</label>
            <input
              type="checkbox"
              id="labels"
              onchange="labelsChange()"
              checked
            />
            <span> &NonBreakingSpace; </span>
            <button type="button" onclick="screenshot()">Screenshot</button>
            <div id="frcv-about" style="margin-top: 20px">
              <!-- about text here -->
            </div>
          </div>
          <div style="float: right">
            <div id="map-chart-paris" style="width: 240px"></div>
          </div>
        </div>

        <div style="display: inline-block; width: 600px; margin-left: 40px">
          <div id="map-chart"></div>
        </div>
      </div>
    </div>

    <script src="js/lib/lotivis.js"></script>
    <script src="js/lib/frc.js"></script>

    <script>
      lotivis.debug(true);

      let datasets = [];
      let mapChart = lotivis
        .map()
        .selector("#map-chart")
        .width(700)
        .height(700)
        .labels(true)
        .labelsExclude(["75", "92", "93", "94"])
        .exclude(["2A", "2B"])
        .featureIDAccessor((f) => "" + f.properties.code)
        .featureNameAccessor((f) => f.properties.nom);

      let mapChartParis = lotivis
        .map()
        .selector("#map-chart-paris")
        .width(300)
        .height(300)
        .labels(true)
        .legend(false)
        .legendPanel(false)
        .include(["75", "92", "93", "94"])
        .featureIDAccessor((f) => "" + f.properties.code)
        .featureNameAccessor((f) => f.properties.nom);

      function screenshot() {
        mapChart.pngDownload(() => {
          mapChartParis.pngDownload();
        });
      }

      function labelsChange() {
        mapChart.labels(document.getElementById("labels").checked).run();
        mapChartParis.labels(document.getElementById("labels").checked).run();
      }

      function dataChange() {
        setDataset(document.getElementById("data").selectedIndex);
      }

      function setDataset(index) {
        let data = datasets[index];
        let dataController = lotivis.parseDatasets(data);

        document.getElementById("frcv-about").innerText = data[0].about || "";

        mapChart.dataController(dataController).run();
        mapChartParis.dataController(dataController).run();
      }

      Promise.all([
        lotivis.d3.json("./assets/department.to.artists.json"),
        lotivis.d3.json("./assets/department.to.tracks.json"),
        lotivis.d3.json("./assets/department.to.tokens.and.types.json"),
        lotivis.d3.json("./assets/department.to.innovation.list.relative.json"),
        lotivis.d3.json(
          "./assets/department.to.innovation.list.tokens.relative.json"
        ),
        lotivis.d3.json("./assets/departements.geojson"),
      ])
        .then((all) => {
          let geoJSON = all.pop();
          mapChart.geoJSON(geoJSON);
          mapChartParis.geoJSON(geoJSON);

          datasets = all;
          setDataset(0);
        })
        .catch((error) => {
          console.log(error);
          alert(error);
        });
    </script>
  </body>
</html>
